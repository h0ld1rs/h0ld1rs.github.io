<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Go渗透测试笔记(三) | h0ld1rs的博客</title><meta name="keywords" content="Golang,渗透测试"><meta name="author" content="h0ld1rs"><meta name="copyright" content="h0ld1rs"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="对Go渗透测试中的一些学习">
<meta property="og:type" content="article">
<meta property="og:title" content="Go渗透测试笔记(三)">
<meta property="og:url" content="https://h0ld1rs.github.io/posts/32502.html">
<meta property="og:site_name" content="h0ld1rs的博客">
<meta property="og:description" content="对Go渗透测试中的一些学习">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://h0ld1rs.github.io/img/image/4.png">
<meta property="article:published_time" content="2022-03-01T13:39:42.000Z">
<meta property="article:modified_time" content="2022-03-02T03:45:51.699Z">
<meta property="article:author" content="h0ld1rs">
<meta property="article:tag" content="Golang,渗透测试">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://h0ld1rs.github.io/img/image/4.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://h0ld1rs.github.io/posts/32502"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Go渗透测试笔记(三)',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-03-02 11:45:51'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.0.0"><link rel="alternate" href="/atom.xml" title="h0ld1rs的博客" type="application/atom+xml">
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/1.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">19</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">7</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 目录</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/image/4.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">h0ld1rs的博客</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 目录</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Go渗透测试笔记(三)</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-03-01T13:39:42.000Z" title="发表于 2022-03-01 21:39:42">2022-03-01</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-03-02T03:45:51.699Z" title="更新于 2022-03-02 11:45:51">2022-03-02</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Go%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/">Go渗透测试</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Go渗透测试笔记(三)"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/posts/32502.html#post-comment"><span id="twikoo-count"></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Go渗透测试笔记-三-—HTTP客户端与工具的远程交互"><a href="#Go渗透测试笔记-三-—HTTP客户端与工具的远程交互" class="headerlink" title="Go渗透测试笔记(三)—HTTP客户端与工具的远程交互"></a>Go渗透测试笔记(三)—HTTP客户端与工具的远程交互</h1><h2 id="0x00-Go的HTTP基础知识"><a href="#0x00-Go的HTTP基础知识" class="headerlink" title="0x00 Go的HTTP基础知识"></a>0x00 Go的HTTP基础知识</h2><ol>
<li>HTTP是一种无状态的协议，服务器不会维护每个请求的状态，而是通过多种方式跟踪其状态，这些方式可能包括：<code>会话标识符，cookie，HTTP标头等</code>。客户端和服务器有责任正确协商和验证状态</li>
<li>其次，客户端和服务器之间的通信可以一部或者同步进行，但他们需要以<code>请求/响应</code>的方式循环运行。可以在请求头中添加几个选项和表标头，以影响服务器的行为并创建可用的Web应用程序。最常见的是服务器托管Web浏览器渲染的文件，以生成数据的图形化，组织化和时尚化的表示形式。API通常使用<code>XML,JSON,MSGRPC</code>进行通信，某些情况下，可能检索到的是二进制格式，表示下载任意文件类型</li>
</ol>
<h2 id="0X01-调用HTTP-API"><a href="#0X01-调用HTTP-API" class="headerlink" title="0X01 调用HTTP API"></a>0X01 调用HTTP API</h2><h3 id="1-调用HTTP方法"><a href="#1-调用HTTP方法" class="headerlink" title="1. 调用HTTP方法"></a>1. 调用HTTP方法</h3><p>包使用<code>net/http</code></p>
<p>这些函数的使用格式如下</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Get(url <span class="type">string</span>)(resp *Response,err <span class="type">error</span>)</span><br><span class="line">Head(url <span class="type">string</span>)(resp * Response,err <span class="type">error</span>)</span><br><span class="line">Post(url <span class="type">string</span>,bodyType <span class="type">string</span>,body io.Reader)(resp *Response.err <span class="type">error</span>)</span><br></pre></td></tr></table></figure>

<p>每个函数都将URL字符串作为参数并将其用作请求的目的地。Post函数要比较复杂一些，Post()具有两个附加参数(bodyType 和io.Reader)，其中 bodyType()用于接受正文的<code>Content-Type</code>，HTTP标头，(通常为 application&#x2F;x-www-form-urlencoded)</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">	<span class="string">&quot;net/url&quot;</span></span><br><span class="line">	<span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	r1,err := http.Get(<span class="string">&quot;http://www.baidu.com&quot;</span>)</span><br><span class="line">	<span class="comment">//读取响应正文，未显示</span></span><br><span class="line">	<span class="keyword">if</span> err !=<span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalln(<span class="string">&quot;无法调用&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> r1.Body.Close()</span><br><span class="line">	r2,err := http.Head(<span class="string">&quot;http://www.baidu.com&quot;</span>)</span><br><span class="line">	<span class="comment">//读取响应正文，未显示</span></span><br><span class="line">	<span class="keyword">defer</span> r2.Body.Close()</span><br><span class="line">	form := url.Values&#123;&#125;</span><br><span class="line">	form.Add(<span class="string">&quot;foo&quot;</span>,<span class="string">&quot;bar&quot;</span>)</span><br><span class="line">	r3,err := http.Post(</span><br><span class="line">		<span class="string">&quot;http://www.goole.com&quot;</span>,</span><br><span class="line">		<span class="string">&quot;application/x-www-form-urlencode&quot;</span>,</span><br><span class="line">		strings.NewReader(form.Encode()),</span><br><span class="line">		)</span><br><span class="line">	<span class="comment">//读取响应正文，未显示</span></span><br><span class="line">	<span class="keyword">defer</span> r3.Body.Close()</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>当然，Go又一个函数<code>PostForm()</code>可以代替</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">	<span class="string">&quot;net/url&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	r1,err := http.Get(<span class="string">&quot;http://www.baidu.com&quot;</span>)</span><br><span class="line">	<span class="comment">//读取响应正文，未显示</span></span><br><span class="line">	<span class="keyword">if</span> err !=<span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalln(<span class="string">&quot;无法调用&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> r1.Body.Close()</span><br><span class="line">	r2,err := http.Head(<span class="string">&quot;http://www.baidu.com&quot;</span>)</span><br><span class="line">	<span class="comment">//读取响应正文，未显示</span></span><br><span class="line">	<span class="keyword">defer</span> r2.Body.Close()</span><br><span class="line">	form := url.Values&#123;&#125;</span><br><span class="line">	form.Add(<span class="string">&quot;foo&quot;</span>,<span class="string">&quot;bar&quot;</span>)</span><br><span class="line">	r3,err := http.PostForm(<span class="string">&quot;http://www.baidu,com&quot;</span>,form)</span><br><span class="line">	<span class="comment">//读取响应正文，未显示</span></span><br><span class="line">	<span class="keyword">defer</span> r3.Body.Close()</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>其他的HTTP动词，如<code>PATCH,PUT,DELETE</code>，不存在便捷函数，我们主要使用这些动词来与<code>RESTFUL api</code>进行交互</p>
<h3 id="2-生成一个请求"><a href="#2-生成一个请求" class="headerlink" title="2. 生成一个请求"></a>2. 生成一个请求</h3><p>我们可以使用<code>NewRequest()</code>创建结构体 <code>Request</code>，然后使用Client的<code>Do()发送该结构体</code></p>
<p>结构如下</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewRequest</span><span class="params">(method, url <span class="type">string</span>, body io.Reader)</span></span> (*Request, <span class="type">error</span>) &#123;</span><br><span class="line">	<span class="keyword">return</span> NewRequestWithContext(context.Background(), method, url, body)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当我们需要发送一个<code>DELETE</code>的请求，可以</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	req,err := http.NewRequest(<span class="string">&quot;DELETE&quot;</span>,<span class="string">&quot;http://www.baidu.com&quot;</span>,<span class="literal">nil</span>)</span><br><span class="line">	<span class="keyword">var</span> client http.Client</span><br><span class="line">	resp,err := client.Do(req)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Panicln(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//读取响应内容并关闭</span></span><br><span class="line">	resp.Body.Close()</span><br><span class="line">	fmt.Println(resp.Status)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>下面是一个<code>io.Reader</code>的<code>Put</code>请求</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">	<span class="string">&quot;net/url&quot;</span></span><br><span class="line">	<span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	form := url.Values&#123;&#125;</span><br><span class="line">	form.Add(<span class="string">&quot;foo&quot;</span>,<span class="string">&quot;bar&quot;</span>)</span><br><span class="line">	<span class="keyword">var</span> client http.Client</span><br><span class="line">	req,err := http.NewRequest(</span><br><span class="line">		<span class="string">&quot;PUT&quot;</span>,</span><br><span class="line">		<span class="string">&quot;http://www.goole.com&quot;</span>,</span><br><span class="line">		strings.NewReader(form.Encode()),</span><br><span class="line">	)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</span><br><span class="line">		log.Fatalln(<span class="string">&quot;failed&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	resp,err := client.Do(req)</span><br><span class="line">	fmt.Println(resp.Status)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="3-使用结构化进行解析"><a href="#3-使用结构化进行解析" class="headerlink" title="3. 使用结构化进行解析"></a>3. 使用结构化进行解析</h3><p>在发送请求后，我们需要<code>ioutil.ReadAll()</code>获取响应正文读取数据，进行一些错误检查，并将HTTP状态码和响应正文打印到<code>stdout</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  &#123;</span><br><span class="line">	resp,err := http.Get(<span class="string">&quot;https://www.baidu.com/robots.txt&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</span><br><span class="line">		log.Fatalln(<span class="string">&quot;failed&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(resp.Status)</span><br><span class="line">	<span class="comment">//读取并显示响应正文</span></span><br><span class="line">	body,err :=ioutil.ReadAll(resp.Body)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalln(err)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="type">string</span>(body))</span><br><span class="line">	resp.Body.Close()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在接收到<code>resp</code>的响应后，可以通过访问可输出的参数<code>Status</code>来检索状态字符串(例如200 OK)，还有一个与此类似的参数<code>StatusCode</code></p>
<p><code>Response</code>类型。该参数仅存状态字符串的整数部分</p>
<p><code>Response</code>类型包含一个可输出的参数<code>Body</code>，其类型为<code>io.ReadCloser</code>，<code>ioReadCloser</code>充当<code>io.Reader</code>以及<code>io.Closer</code>的接口，或者需要实现<code>Close()</code>函数以关闭reader并执行任何清理的接口。从<code>io.ReadCloser</code>读取数据后，需要在响应正文上调用<code>Close()</code>函数。使用<code>defer</code>关闭响应正文是一种常见的作法，这样可以保证函数在返回之前将其关闭</p>
<p>返回内容如下</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><span class="line">200 OK</span><br><span class="line">User-agent: Baiduspider</span><br><span class="line">Disallow: /baidu</span><br><span class="line">Disallow: /s?</span><br><span class="line">Disallow: /ulink?</span><br><span class="line">Disallow: /link?</span><br><span class="line">Disallow: /home/news/data/</span><br><span class="line">Disallow: /bh</span><br><span class="line"></span><br><span class="line">User-agent: Googlebot</span><br><span class="line">Disallow: /baidu</span><br><span class="line">Disallow: /s?</span><br><span class="line">Disallow: /shifen/</span><br><span class="line">Disallow: /homepage/</span><br><span class="line">Disallow: /cpro</span><br><span class="line">Disallow: /ulink?</span><br><span class="line">Disallow: /link?</span><br><span class="line">Disallow: /home/news/data/</span><br><span class="line">Disallow: /bh</span><br><span class="line"></span><br><span class="line">User-agent: MSNBot</span><br><span class="line">Disallow: /baidu</span><br><span class="line">Disallow: /s?</span><br><span class="line">Disallow: /shifen/</span><br><span class="line">Disallow: /homepage/</span><br><span class="line">Disallow: /cpro</span><br><span class="line">Disallow: /ulink?</span><br><span class="line">Disallow: /link?</span><br><span class="line">Disallow: /home/news/data/</span><br><span class="line">Disallow: /bh</span><br><span class="line"></span><br><span class="line">User-agent: Baiduspider-image</span><br><span class="line">Disallow: /baidu</span><br><span class="line">Disallow: /s?</span><br><span class="line">Disallow: /shifen/</span><br><span class="line">Disallow: /homepage/</span><br><span class="line">Disallow: /cpro</span><br><span class="line">Disallow: /ulink?</span><br><span class="line">Disallow: /link?</span><br><span class="line">Disallow: /home/news/data/</span><br><span class="line">Disallow: /bh</span><br><span class="line"></span><br><span class="line">User-agent: YoudaoBot</span><br><span class="line">Disallow: /baidu</span><br><span class="line">Disallow: /s?</span><br><span class="line">Disallow: /shifen/</span><br><span class="line">Disallow: /homepage/</span><br><span class="line">Disallow: /cpro</span><br><span class="line">Disallow: /ulink?</span><br><span class="line">Disallow: /link?</span><br><span class="line">Disallow: /home/news/data/</span><br><span class="line">Disallow: /bh</span><br><span class="line"></span><br><span class="line">User-agent: Sogou web spider</span><br><span class="line">Disallow: /baidu</span><br><span class="line">Disallow: /s?</span><br><span class="line">Disallow: /shifen/</span><br><span class="line">Disallow: /homepage/</span><br><span class="line">Disallow: /cpro</span><br><span class="line">Disallow: /ulink?</span><br><span class="line">Disallow: /link?</span><br><span class="line">Disallow: /home/news/data/</span><br><span class="line">Disallow: /bh</span><br><span class="line"></span><br><span class="line">User-agent: Sogou inst spider</span><br><span class="line">Disallow: /baidu</span><br><span class="line">Disallow: /s?</span><br><span class="line">Disallow: /shifen/</span><br><span class="line">Disallow: /homepage/</span><br><span class="line">Disallow: /cpro</span><br><span class="line">Disallow: /ulink?</span><br><span class="line">Disallow: /link?</span><br><span class="line">Disallow: /home/news/data/</span><br><span class="line">Disallow: /bh</span><br><span class="line"></span><br><span class="line">User-agent: Sogou spider2</span><br><span class="line">Disallow: /baidu</span><br><span class="line">Disallow: /s?</span><br><span class="line">Disallow: /shifen/</span><br><span class="line">Disallow: /homepage/</span><br><span class="line">Disallow: /cpro</span><br><span class="line">Disallow: /ulink?</span><br><span class="line">Disallow: /link?</span><br><span class="line">Disallow: /home/news/data/</span><br><span class="line">Disallow: /bh</span><br><span class="line"></span><br><span class="line">User-agent: Sogou blog</span><br><span class="line">Disallow: /baidu</span><br><span class="line">Disallow: /s?</span><br><span class="line">Disallow: /shifen/</span><br><span class="line">Disallow: /homepage/</span><br><span class="line">Disallow: /cpro</span><br><span class="line">Disallow: /ulink?</span><br><span class="line">Disallow: /link?</span><br><span class="line">Disallow: /home/news/data/</span><br><span class="line">Disallow: /bh</span><br><span class="line"></span><br><span class="line">User-agent: Sogou News Spider</span><br><span class="line">Disallow: /baidu</span><br><span class="line">Disallow: /s?</span><br><span class="line">Disallow: /shifen/</span><br><span class="line">Disallow: /homepage/</span><br><span class="line">Disallow: /cpro</span><br><span class="line">Disallow: /ulink?</span><br><span class="line">Disallow: /link?</span><br><span class="line">Disallow: /home/news/data/</span><br><span class="line">Disallow: /bh</span><br><span class="line"></span><br><span class="line">User-agent: Sogou Orion spider</span><br><span class="line">Disallow: /baidu</span><br><span class="line">Disallow: /s?</span><br><span class="line">Disallow: /shifen/</span><br><span class="line">Disallow: /homepage/</span><br><span class="line">Disallow: /cpro</span><br><span class="line">Disallow: /ulink?</span><br><span class="line">Disallow: /link?</span><br><span class="line">Disallow: /home/news/data/</span><br><span class="line">Disallow: /bh</span><br><span class="line"></span><br><span class="line">User-agent: ChinasoSpider</span><br><span class="line">Disallow: /baidu</span><br><span class="line">Disallow: /s?</span><br><span class="line">Disallow: /shifen/</span><br><span class="line">Disallow: /homepage/</span><br><span class="line">Disallow: /cpro</span><br><span class="line">Disallow: /ulink?</span><br><span class="line">Disallow: /link?</span><br><span class="line">Disallow: /home/news/data/</span><br><span class="line">Disallow: /bh</span><br><span class="line"></span><br><span class="line">User-agent: Sosospider</span><br><span class="line">Disallow: /baidu</span><br><span class="line">Disallow: /s?</span><br><span class="line">Disallow: /shifen/</span><br><span class="line">Disallow: /homepage/</span><br><span class="line">Disallow: /cpro</span><br><span class="line">Disallow: /ulink?</span><br><span class="line">Disallow: /link?</span><br><span class="line">Disallow: /home/news/data/</span><br><span class="line">Disallow: /bh</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">User-agent: yisouspider</span><br><span class="line">Disallow: /baidu</span><br><span class="line">Disallow: /s?</span><br><span class="line">Disallow: /shifen/</span><br><span class="line">Disallow: /homepage/</span><br><span class="line">Disallow: /cpro</span><br><span class="line">Disallow: /ulink?</span><br><span class="line">Disallow: /link?</span><br><span class="line">Disallow: /home/news/data/</span><br><span class="line">Disallow: /bh</span><br><span class="line"></span><br><span class="line">User-agent: EasouSpider</span><br><span class="line">Disallow: /baidu</span><br><span class="line">Disallow: /s?</span><br><span class="line">Disallow: /shifen/</span><br><span class="line">Disallow: /homepage/</span><br><span class="line">Disallow: /cpro</span><br><span class="line">Disallow: /ulink?</span><br><span class="line">Disallow: /link?</span><br><span class="line">Disallow: /home/news/data/</span><br><span class="line">Disallow: /bh</span><br><span class="line"></span><br><span class="line">User-agent: *</span><br><span class="line">Disallow: /</span><br></pre></td></tr></table></figure>

<p>如果需要解析更多的结构化数据，如<code>JSON</code>格式的数据进行<code>API</code>交互，则可以使用</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;encoding/json&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Status <span class="keyword">struct</span> &#123;</span><br><span class="line">	Message <span class="type">string</span></span><br><span class="line">	Status <span class="type">string</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  &#123;</span><br><span class="line">	res,err := http.Post(</span><br><span class="line">		<span class="string">&quot;http://IP:PORT/API&quot;</span>,</span><br><span class="line">		<span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">		<span class="literal">nil</span>,</span><br><span class="line">		)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</span><br><span class="line">		log.Fatalln(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">var</span> status Status</span><br><span class="line">	<span class="keyword">if</span> err := json.NewDecoder(res.Body).Decode(&amp;status);err != <span class="literal">nil</span>&#123;</span><br><span class="line">		log.Fatalln(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> res.Body.Close()</span><br><span class="line">	log.Printf(<span class="string">&quot;%s-&gt;%s\n&quot;</span>,status.Status,status.Message)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="0X02-构建与Shodan交互的HTTP客户端"><a href="#0X02-构建与Shodan交互的HTTP客户端" class="headerlink" title="0X02 构建与Shodan交互的HTTP客户端"></a>0X02 构建与Shodan交互的HTTP客户端</h2><p>当一个泄露的错误消息的web应用会被列入低危险等级，但是，如果错误消息泄露了企业用户的格式，并且其VPN内使用了单因素身份认证，则这些消息可能会增加通过猜测密码攻击内部网络的可能性</p>
<p>以<code>Shodan</code>为例子,需要一个<code>Shodan</code>的<code>api密钥</code>。</p>
<p>从Shodan 站点获取 API 密钥并将其设为环境变量，仅当API密钥为<code>SHODAN_API_KEY</code>的时候，下面示例才能正常工作</p>
<p><code>SHODAN API</code>非常简单，可以生成良好的<code>JSON</code>响应，对初学者学习<code>API</code>交互很有帮助，以下是步骤</p>
<ol>
<li>查看服务的<code>API</code>文档</li>
<li>设计代码的逻辑结构，以减少代码的复杂性和复用性</li>
<li>根据需要在<code>Go</code> 中定义请求或者响应类型。</li>
<li>创建辅助函数或者类型以简化初始化，身份认证和通信，从而减少冗长或者复杂的逻辑</li>
<li>构建与<code>API</code>消费者函数和类型交互的客户端</li>
</ol>
<h3 id="1-清理API调用"><a href="#1-清理API调用" class="headerlink" title="1. 清理API调用"></a>1. 清理API调用</h3><p>在阅读<code>SHODAN</code>文档的时候，你应该已经注意到：每个公开的函数都需要发送<code>API密钥</code>，尽管这个值传递给你所创建的每个消费者函数，但这么操作会非常繁琐。硬编码处理基础<code>https://api.shodan.io</code>也会遇到相同的问题，如下面函数所示，要定义API函数，需要将令牌和URL一起传递给每个函数。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">APIInfo</span><span class="params">(token, url <span class="type">string</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">HostSearch</span><span class="params">(token, url <span class="type">string</span>)</span></span></span><br></pre></td></tr></table></figure>

<p>因此，我们选择一种更为常用的方法，先创建一个<code>shodan.go</code>文件</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Shodan</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> BaseURL = <span class="string">&quot;http://api.shodan.io&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Client <span class="keyword">struct</span> &#123;</span><br><span class="line">	apiKey <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">New</span><span class="params">(apikey <span class="type">string</span>)</span></span> *Client  &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;Client&#123;apikey: apikey&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Shodan URL 被定义为一个常见值，这样我们在实现函数中重用它，</p>
<p>由于这些是结构体<code>Client</code>上的方法，因此可以通过<code>s.apiKey</code>去检索<code>API</code>密钥，并且通过<code>BaseURL</code>去检索<code>URL</code></p>
<h3 id="2-查询Shodan-订阅情况"><a href="#2-查询Shodan-订阅情况" class="headerlink" title="2. 查询Shodan 订阅情况"></a>2. 查询Shodan 订阅情况</h3><p>现在，开始与<code>Shodan</code>进行互动，根据<code>API</code>文档，用于查询信息的调用如下</p>
<blockquote>
<p>shodan 文档：<a target="_blank" rel="noopener" href="https://developer.shodan.io/api">https://developer.shodan.io/api</a></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://api.shodan.io/api-info?key=&#123;YOUR_API_KEY&#125;</span><br></pre></td></tr></table></figure>

<p>返回信息是如下的格式</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;scan_credits&quot;</span><span class="punctuation">:</span> <span class="number">100000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;usage_limits&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;scan_credits&quot;</span><span class="punctuation">:</span> <span class="number">-1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;query_credits&quot;</span><span class="punctuation">:</span> <span class="number">-1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;monitored_ips&quot;</span><span class="punctuation">:</span> <span class="number">-1</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;plan&quot;</span><span class="punctuation">:</span> <span class="string">&quot;stream-100&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;https&quot;</span><span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;unlocked&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;query_credits&quot;</span><span class="punctuation">:</span> <span class="number">100000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;monitored_ips&quot;</span><span class="punctuation">:</span> <span class="number">19</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;unlocked_left&quot;</span><span class="punctuation">:</span> <span class="number">100000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;telnet&quot;</span><span class="punctuation">:</span> <span class="keyword">false</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>我们首先需要在<code>api.go</code>中定义一个可用于把<code>json</code>响应解组为<code>go</code>结构体的类型，如果缺少这一步，将无法处理或者访问响应正文。</p>
<p>新建<code>api.go</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Shodan</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;encoding/json&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> APIInfo <span class="keyword">struct</span> &#123;</span><br><span class="line">	QueryCredits <span class="type">int</span>    <span class="string">`json:&quot;query_credits&quot;`</span></span><br><span class="line">	ScanCredits  <span class="type">int</span>    <span class="string">`json:&quot;scan_credits&quot;`</span></span><br><span class="line">	Telnet       <span class="type">bool</span>   <span class="string">`json:&quot;telnet&quot;`</span></span><br><span class="line">	Plan         <span class="type">string</span> <span class="string">`json:&quot;plan&quot;`</span></span><br><span class="line">	Https        <span class="type">bool</span>   <span class="string">`json:&quot;https&quot;`</span></span><br><span class="line">	Unlocked     <span class="type">bool</span>   <span class="string">`json:&quot;unlocked&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Client)</span></span>APIInfo()(*APIInfo, <span class="type">error</span>)  &#123;</span><br><span class="line">	res,err := http.Get(fmt.Sprintf(<span class="string">&quot;%s/api-info?key=%s&quot;</span>,BaseURL,s.apikey))</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>,err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">var</span> ret  APIInfo;</span><br><span class="line">	<span class="keyword">if</span> err := json.NewDecoder(res.Body).Decode(&amp;ret);err != <span class="literal">nil</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>,err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> &amp;ret,<span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>使用结构体数据显式调用<code>json</code>元素名称，以确保映射和解析数据</p>
<p>同时<code>APIInfo</code>发出HTTP的<code>Get</code>请求，，并将响应解码成<code>APIInfo</code>的结构体</p>
<p>我们在使用这段代码前，还需要使用一个有用的<code>API</code>调用(主机搜索)，将其添加到<code>host.go</code>文件中。</p>
<blockquote>
<p>根据API文档，该调用的请求和响应如下</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:<span class="comment">//api.shodan.io/shodan/host/search?key=&#123;YOUR_API_KEY&#125;&amp;query=&#123;query&#125;&amp;facets=&#123;facets&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">----有删减--------</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;matches&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;product&quot;</span>: <span class="string">&quot;nginx&quot;</span>,</span><br><span class="line">            <span class="string">&quot;hash&quot;</span>: <span class="number">-1609083510</span>,</span><br><span class="line">            <span class="string">&quot;ip&quot;</span>: <span class="number">1616761883</span>,</span><br><span class="line">            <span class="string">&quot;org&quot;</span>: <span class="string">&quot;Comcast Business&quot;</span>,</span><br><span class="line">            <span class="string">&quot;isp&quot;</span>: <span class="string">&quot;Comcast Business&quot;</span>,</span><br><span class="line">            <span class="string">&quot;transport&quot;</span>: <span class="string">&quot;tcp&quot;</span>,</span><br><span class="line">            <span class="string">&quot;cpe&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;cpe:/a:igor_sysoev:nginx&quot;</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">&quot;data&quot;</span>: <span class="string">&quot;HTTP/1.1 400 Bad Request\r\nServer: nginx\r\nDate: Mon, 25 Jan 2021 21:33:48 GMT\r\nContent-Type: text/html\r\nContent-Length: 650\r\nConnection: close\r\n\r\n&quot;</span>,</span><br><span class="line">            <span class="string">&quot;asn&quot;</span>: <span class="string">&quot;AS7922&quot;</span>,</span><br><span class="line">            <span class="string">&quot;port&quot;</span>: <span class="number">443</span>,</span><br><span class="line">            <span class="string">&quot;hostnames&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;three.webapplify.net&quot;</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">&quot;location&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;city&quot;</span>: <span class="string">&quot;Denver&quot;</span>,</span><br><span class="line">                <span class="string">&quot;region_code&quot;</span>: <span class="string">&quot;CO&quot;</span>,</span><br><span class="line">                <span class="string">&quot;area_code&quot;</span>: null,</span><br><span class="line">                <span class="string">&quot;longitude&quot;</span>: <span class="number">-104.9078</span>,</span><br><span class="line">                <span class="string">&quot;country_code3&quot;</span>: null,</span><br><span class="line">                <span class="string">&quot;latitude&quot;</span>: <span class="number">39.7301</span>,</span><br><span class="line">                <span class="string">&quot;postal_code&quot;</span>: null,</span><br><span class="line">                <span class="string">&quot;dma_code&quot;</span>: <span class="number">751</span>,</span><br><span class="line">                <span class="string">&quot;country_code&quot;</span>: <span class="string">&quot;US&quot;</span>,</span><br><span class="line">                <span class="string">&quot;country_name&quot;</span>: <span class="string">&quot;United States&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;timestamp&quot;</span>: <span class="string">&quot;2021-01-25T21:33:49.154513&quot;</span>,</span><br><span class="line">            <span class="string">&quot;domains&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;webapplify.net&quot;</span></span><br><span class="line">            ],</span><br><span class="line">         </span><br><span class="line">            <span class="string">&quot;http&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;robots_hash&quot;</span>: null,</span><br><span class="line">                <span class="string">&quot;redirects&quot;</span>: [],</span><br><span class="line">                <span class="string">&quot;securitytxt&quot;</span>: null,</span><br><span class="line">                <span class="string">&quot;title&quot;</span>: <span class="string">&quot;410 Gone&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sitemap_hash&quot;</span>: null,</span><br><span class="line">                <span class="string">&quot;robots&quot;</span>: null,</span><br><span class="line">                <span class="string">&quot;server&quot;</span>: <span class="string">&quot;nginx/1.4.2&quot;</span>,</span><br><span class="line">                <span class="string">&quot;host&quot;</span>: <span class="string">&quot;185.11.246.51&quot;</span>,</span><br><span class="line">                <span class="string">&quot;html&quot;</span>: <span class="string">&quot;\n\n410 Gone\n\nGone\nThe requested resource/\nis no longer available on this server and there is no forwarding address.\nPlease remove all references to this resource.\n\n&quot;</span>,</span><br><span class="line">                <span class="string">&quot;location&quot;</span>: <span class="string">&quot;/&quot;</span>,</span><br><span class="line">                <span class="string">&quot;components&quot;</span>: &#123;&#125;,</span><br><span class="line">                <span class="string">&quot;securitytxt_hash&quot;</span>: null,</span><br><span class="line">                <span class="string">&quot;sitemap&quot;</span>: null,</span><br><span class="line">                <span class="string">&quot;html_hash&quot;</span>: <span class="number">922034037</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;os&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;_shodan&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;crawler&quot;</span>: <span class="string">&quot;c9b639b99e5410a46f656e1508a68f1e6e5d6f99&quot;</span>,</span><br><span class="line">                <span class="string">&quot;ptr&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="string">&quot;id&quot;</span>: <span class="string">&quot;118b7360-01d0-4edb-8ee9-01e411c23e60&quot;</span>,</span><br><span class="line">                <span class="string">&quot;module&quot;</span>: <span class="string">&quot;auto&quot;</span>,</span><br><span class="line">                <span class="string">&quot;options&quot;</span>: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;ip_str&quot;</span>: <span class="string">&quot;185.11.246.51&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        ...</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;facets&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;country&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                </span><br><span class="line">                <span class="string">&quot;count&quot;</span>: <span class="number">1717359</span>,</span><br><span class="line">                <span class="string">&quot;value&quot;</span>: <span class="string">&quot;HK&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;count&quot;</span>: <span class="number">940900</span>,</span><br><span class="line">                <span class="string">&quot;value&quot;</span>: <span class="string">&quot;FR&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;total&quot;</span>: <span class="number">23047224</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们的代码是</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Shodan</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;encoding/json&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> HostLocation <span class="keyword">struct</span> &#123;</span><br><span class="line">	City         <span class="type">string</span>  <span class="string">`json:&quot;city&quot;`</span></span><br><span class="line">	RegionCode   <span class="type">string</span>  <span class="string">`json:&quot;region_code&quot;`</span></span><br><span class="line">	AreaCode     <span class="type">int</span>     <span class="string">`json:&quot;area_code&quot;`</span></span><br><span class="line">	Longitude    <span class="type">float32</span> <span class="string">`json:&quot;longitude&quot;`</span></span><br><span class="line">	CountryCode3 <span class="type">string</span>  <span class="string">`json:&quot;country_code3&quot;`</span></span><br><span class="line">	CountryName  <span class="type">string</span>  <span class="string">`json:&quot;country_name&quot;`</span></span><br><span class="line">	PostalCode   <span class="type">string</span>  <span class="string">`json:&quot;postal_code&quot;`</span></span><br><span class="line">	DMACode      <span class="type">int</span>     <span class="string">`json:&quot;dma_code&quot;`</span></span><br><span class="line">	CountryCode  <span class="type">string</span>  <span class="string">`json:&quot;country_code&quot;`</span></span><br><span class="line">	Latitude     <span class="type">float32</span> <span class="string">`json:&quot;latitude&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Host <span class="keyword">struct</span> &#123;</span><br><span class="line">	OS        <span class="type">string</span>       <span class="string">`json:&quot;os&quot;`</span></span><br><span class="line">	Timestamp <span class="type">string</span>       <span class="string">`json:&quot;timestamp&quot;`</span></span><br><span class="line">	ISP       <span class="type">string</span>       <span class="string">`json:&quot;isp&quot;`</span></span><br><span class="line">	ASN       <span class="type">string</span>       <span class="string">`json:&quot;asn&quot;`</span></span><br><span class="line">	Hostnames []<span class="type">string</span>     <span class="string">`json:&quot;hostnames&quot;`</span></span><br><span class="line">	Location  HostLocation <span class="string">`json:&quot;location&quot;`</span></span><br><span class="line">	IP        <span class="type">int64</span>        <span class="string">`json:&quot;ip&quot;`</span></span><br><span class="line">	Domains   []<span class="type">string</span>     <span class="string">`json:&quot;domains&quot;`</span></span><br><span class="line">	Org       <span class="type">string</span>       <span class="string">`json:&quot;org&quot;`</span></span><br><span class="line">	Data      <span class="type">string</span>       <span class="string">`json:&quot;data&quot;`</span></span><br><span class="line">	Port      <span class="type">int</span>          <span class="string">`json:&quot;port&quot;`</span></span><br><span class="line">	IPString  <span class="type">string</span>       <span class="string">`json:&quot;ip_str&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> HostSearch <span class="keyword">struct</span> &#123;</span><br><span class="line">	Matches []Host <span class="string">`json:&quot;matches&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Client)</span></span> HostSearch(q <span class="type">string</span>) (*HostSearch, <span class="type">error</span>) &#123;</span><br><span class="line">	res, err := http.Get(</span><br><span class="line">		fmt.Sprintf(<span class="string">&quot;%s/shodan/host/search?key=%s&amp;query=%s&quot;</span>, BaseURL, s.apiKey, q),</span><br><span class="line">	)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> res.Body.Close()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> ret HostSearch</span><br><span class="line">	<span class="keyword">if</span> err := json.NewDecoder(res.Body).Decode(&amp;ret); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> &amp;ret, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>HostSearch：用于解析<code>matches</code>数组</li>
<li>Host：表示matches的一个元素</li>
<li>HostLocation：表示主机中的<code>location</code>字段</li>
</ul>
<p>接下来，我们创建main函数</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;Test1/Shodan&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;os&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(os.Args) != <span class="number">2</span> &#123;</span><br><span class="line">		log.Fatalln(<span class="string">&quot;Usage: main &lt;searchterm&gt;&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	apiKey := os.Getenv(<span class="string">&quot;SHODAN_API_KEY&quot;</span>)</span><br><span class="line">	s := Shodan.New(apiKey)</span><br><span class="line">	info, err := s.APIInfo()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Panicln(err)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Printf(</span><br><span class="line">		<span class="string">&quot;Query Credits: %d\nScan Credits:  %d\n\n&quot;</span>,</span><br><span class="line">		info.QueryCredits,</span><br><span class="line">		info.ScanCredits)</span><br><span class="line"></span><br><span class="line">	hostSearch, err := s.HostSearch(os.Args[<span class="number">1</span>])</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Panicln(err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> _, host := <span class="keyword">range</span> hostSearch.Matches &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;%18s%8d\n&quot;</span>, host.IPString, host.Port)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>当我们输入<code>go run main.go Tomcat</code>的时候，便可以查询</p>
<p><img src="https://cdn.jsdelivr.net/gh/h0ld1rs/image/image/20220301213245.png"></p>
<p>OK，一个调用<code>Shodan API</code>的小型 go程序就完成了</p>
<h2 id="0x03-与Metasploit交互"><a href="#0x03-与Metasploit交互" class="headerlink" title="0x03 与Metasploit交互"></a>0x03 与Metasploit交互</h2><p>msf 想必都熟悉，在这里，我们将会构建一个与远程<code>Metasploit</code>实例进行交互的客户端，他要比<code>Shodan</code>更复杂</p>
<p>后来改成如下的启动方式了，(图片请忽略)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">load msgrpc ServerHost=127.0.0.1 ServerPort=55553 User=<span class="string">&#x27;msf&#x27;</span> Pass=<span class="string">&#x27;msf</span></span><br></pre></td></tr></table></figure>

<p>书上让本地启动 <code>msfconsole</code>和 <code>msgrpc</code>，这里，我选择使用<code>kali</code>进行替代</p>
<p><img src="https://cdn.jsdelivr.net/gh/h0ld1rs/image/image/20220301220321.png"></p>
<p>书上说为了保险，避免对一些值进行硬编码，需要将以下值设置到环境变量中去，但是这里为了方便，我就先不设置了。</p>
<p><code>export MSFHOST xxxxxxxx</code></p>
<p><code>export MSFPASS xxxxxx</code></p>
<p>现在如图上方，我们已经运行了<code>MSF 和 RPC</code>的服务器，接下来，我们查看<code>MSF API</code>的开发文档，发现，他与使用<code>JSON</code>交互的<code>Shodan</code>不同，msf使用了<code>MessagePack</code>（一种紧凑而高效的二进制格式）进行通信。但是，由于 go 官方库中不含，所以我们需要下载它</p>
<p><code> go get gopkg.in/vmihailenco/msgpack.v2</code></p>
<h3 id="1-定义目标"><a href="#1-定义目标" class="headerlink" title="1. 定义目标"></a>1. 定义目标</h3><p>现在定义一个RPC包，创建<code>msf.go</code>，</p>
<p>在<code>Metasploit</code>开发人员文档中的方法<code>session.list</code></p>
<blockquote>
<p>官方文档：<a target="_blank" rel="noopener" href="https://docs.rapid7.com/metasploit/rpc-api/">https://docs.rapid7.com/metasploit/rpc-api/</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.rapid7.com/metasploit/standard-api-methods-reference/">https://docs.rapid7.com/metasploit/standard-api-methods-reference/</a></p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="string">&quot;session.list&quot;</span><span class="punctuation">,</span> <span class="string">&quot;token&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>这是最小的目标，它期望接收实现的方法是<code>名称和令牌</code>，<code>token</code>值是一个占位符，由文档可知，这是一个身份认证的令牌，是成功登录<code>RPC</code>服务器发出的，从<code>Metasploit</code>返回的方法<code>session.list</code>响应采用以下格式</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="string">&quot;1&quot;</span> =&gt; <span class="punctuation">&#123;</span></span><br><span class="line">  &#x27;type&#x27; =&gt; <span class="string">&quot;shell&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">&quot;tunnel_local&quot;</span> =&gt; <span class="string">&quot;192.168.35.149:44444&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">&quot;tunnel_peer&quot;</span> =&gt; <span class="string">&quot;192.168.35.149:43886&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">&quot;via_exploit&quot;</span> =&gt; <span class="string">&quot;exploit/multi/handler&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">&quot;via_payload&quot;</span> =&gt; <span class="string">&quot;payload/windows/shell_reverse_tcp&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">&quot;desc&quot;</span> =&gt; <span class="string">&quot;Command shell&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">&quot;info&quot;</span> =&gt; <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">&quot;workspace&quot;</span> =&gt; <span class="string">&quot;Project1&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">&quot;target_host&quot;</span> =&gt; <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">&quot;username&quot;</span> =&gt; <span class="string">&quot;root&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">&quot;uuid&quot;</span> =&gt; <span class="string">&quot;hjahs9kw&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">&quot;exploit_uuid&quot;</span> =&gt; <span class="string">&quot;gcprpj2a&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">&quot;routes&quot;</span> =&gt; <span class="punctuation">[</span> <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<p><img src="https://cdn.jsdelivr.net/gh/h0ld1rs/image/image/20220301224456.png"></p>
<p>该响应作为映射返回，<code>Meterpreter</code>会话标识符是关键，而会话的详细信息是值</p>
<p>现在需要构建 <code>Go</code>数据类型和响应结构体，根据文档，</p>
<p>请求结构体<code>sessionListReq</code>按照<code>Metasploit RPC</code>服务器所接受的方式，将结构化数据，序列化为<code>MessagePack</code>格式，数据以数组的而不是映射的形式传递，因此，<code>RPC</code>希望接受到的是作为值的<code>位置数组</code>。&#x3D;&#x3D;默认情况下，结构体将被编码为包含从属性名称推导出来的键名映射。&#x3D;&#x3D;要禁用此功能且将其强制将其编码为<code>位置数组</code>，必须添加一个名为<code>_msgpack</code>的特殊字段，该字段利用描述符<code>asArray</code>，显示指示编码器&#x2F;解码器将数据视为数组</p>
<p>响应结构体<code>SessionListRes</code>包含响应字段和结构体属性的一一对应关系，该数据本质上是一个请按套映射，外层映射是会话详细信息的会话标识符，内层映射是内层会话的详细信息。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> rpc</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> sessionListReq <span class="keyword">struct</span> &#123;</span><br><span class="line">	_msgpack <span class="keyword">struct</span>&#123;&#125; <span class="string">`msgpack:&quot;,asArray&quot;`</span></span><br><span class="line">	Method   <span class="type">string</span></span><br><span class="line">	Token    <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> SessionListRes <span class="keyword">struct</span> &#123;</span><br><span class="line">	ID          <span class="type">uint32</span> <span class="string">`msgpack:&quot;,omitempty&quot;`</span></span><br><span class="line">	Type        <span class="type">string</span> <span class="string">`msgpack:&quot;type&quot;`</span></span><br><span class="line">	TunnelLocal <span class="type">string</span> <span class="string">`msgpack:&quot;tunnel_local&quot;`</span></span><br><span class="line">	TunnelPeer  <span class="type">string</span> <span class="string">`msgpack:&quot;tunnel_peer&quot;`</span></span><br><span class="line">	ViaExploit  <span class="type">string</span> <span class="string">`msgpack:&quot;via_exploit&quot;`</span></span><br><span class="line">	ViaPayload  <span class="type">string</span> <span class="string">`msgpack:&quot;via_payload&quot;`</span></span><br><span class="line">	Description <span class="type">string</span> <span class="string">`msgpack:&quot;desc&quot;`</span></span><br><span class="line">	Info        <span class="type">string</span> <span class="string">`msgpack:&quot;info&quot;`</span></span><br><span class="line">	Workspace   <span class="type">string</span> <span class="string">`msgpack:&quot;workspace&quot;`</span></span><br><span class="line">	SessionHost <span class="type">string</span> <span class="string">`msgpack:&quot;session_host&quot;`</span></span><br><span class="line">	SessionPort <span class="type">int</span>    <span class="string">`msgpack:&quot;session_port&quot;`</span></span><br><span class="line">	Username    <span class="type">string</span> <span class="string">`msgpack:&quot;username&quot;`</span></span><br><span class="line">	UUID        <span class="type">string</span> <span class="string">`msgpack:&quot;uuid&quot;`</span></span><br><span class="line">	ExploitUUID <span class="type">string</span> <span class="string">`msgpack:&quot;exploit_uuid&quot;`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-获取有效令牌"><a href="#2-获取有效令牌" class="headerlink" title="2. 获取有效令牌"></a>2. 获取有效令牌</h3><p>现在，我们需要获取一个有效的登录令牌来获取请求，为此，我们将为api方法<code>auth.login()</code>发出一个登录请求，该请求满足以下条件</p>
<p><img src="https://cdn.jsdelivr.net/gh/h0ld1rs/image/image/20220301231549.png"></p>
<p>登录失败的话</p>
<p><img src="https://cdn.jsdelivr.net/gh/h0ld1rs/image/image/20220301231713.png"></p>
<p>还有登出令牌的功能</p>
<p><img src="https://cdn.jsdelivr.net/gh/h0ld1rs/image/image/20220301231814.png"></p>
<h3 id="3-定义请求和响应"><a href="#3-定义请求和响应" class="headerlink" title="3. 定义请求和响应"></a>3. 定义请求和响应</h3><p><code>suth.login</code>和<code>auth.logout</code>同理，我们需要使用描述控制符将请求序列化为数组并将响应视为映射</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">type</span> logoutReq <span class="keyword">struct</span> &#123;</span><br><span class="line">	_msgpack    <span class="keyword">struct</span>&#123;&#125; <span class="string">`msgpack:&quot;,asArray&quot;`</span></span><br><span class="line">	Method      <span class="type">string</span></span><br><span class="line">	Token       <span class="type">string</span></span><br><span class="line">	LogoutToken <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> logoutRes <span class="keyword">struct</span> &#123;</span><br><span class="line">	Result <span class="type">string</span> <span class="string">`msgpack:&quot;result&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> loginReq <span class="keyword">struct</span> &#123;</span><br><span class="line">	_msgpack <span class="keyword">struct</span>&#123;&#125; <span class="string">`msgpack:&quot;,asArray&quot;`</span></span><br><span class="line">	Method   <span class="type">string</span></span><br><span class="line">	Username <span class="type">string</span></span><br><span class="line">	Password <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> loginRes <span class="keyword">struct</span> &#123;</span><br><span class="line">	Result       <span class="type">string</span> <span class="string">`msgpack:&quot;result&quot;`</span></span><br><span class="line">	Token        <span class="type">string</span> <span class="string">`msgpack:&quot;token&quot;`</span></span><br><span class="line">	Error        <span class="type">bool</span>   <span class="string">`msgpack:&quot;error&quot;`</span></span><br><span class="line">	ErrorClass   <span class="type">string</span> <span class="string">`msgpack:&quot;error_class&quot;`</span></span><br><span class="line">	ErrorMessage <span class="type">string</span> <span class="string">`msgpack:&quot;error_message&quot;`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>go可以自动的对登录响应进行序列化，仅填充了存在的字段，这意味着我们可以使用单一结构式表示成功或者失败</p>
<h3 id="4-创建配置结构体和RPC方法"><a href="#4-创建配置结构体和RPC方法" class="headerlink" title="4. 创建配置结构体和RPC方法"></a>4. 创建配置结构体和RPC方法</h3><p>创建一个结构体类型，以供数据隐式引用</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Metasploit <span class="keyword">struct</span> &#123;</span><br><span class="line">	host  <span class="type">string</span></span><br><span class="line">	user  <span class="type">string</span></span><br><span class="line">	pass  <span class="type">string</span></span><br><span class="line">	token <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">New</span><span class="params">(host, user, pass <span class="type">string</span>)</span></span> *Metasploit &#123;</span><br><span class="line">	msf := &amp;Metasploit&#123;</span><br><span class="line">		host: host,</span><br><span class="line">		user: user,</span><br><span class="line">		pass: pass,</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> msf</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-执行远程调用"><a href="#5-执行远程调用" class="headerlink" title="5. 执行远程调用"></a>5. 执行远程调用</h3><p>构建一个方法，执行远程调用。为了防止大量的代码重复，先构建一个可以执行，序列化，反序列化和HTTP通信逻辑的方法 send()</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(msf *Metasploit)</span></span> send(req <span class="keyword">interface</span>&#123;&#125;, res <span class="keyword">interface</span>&#123;&#125;) <span class="type">error</span> &#123;</span><br><span class="line">	buf := <span class="built_in">new</span>(bytes.Buffer)</span><br><span class="line">	msgpack.NewEncoder(buf).Encode(req)</span><br><span class="line">	dest := fmt.Sprintf(<span class="string">&quot;http://%s/api&quot;</span>, msf.host)</span><br><span class="line">	r, err := http.Post(dest, <span class="string">&quot;binary/message-pack&quot;</span>, buf)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> r.Body.Close()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err := msgpack.NewDecoder(r.Body).Decode(&amp;res); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在<code>send</code>方法中，接受interface{}类型的请求和响应参数。使用此接口类型，可以将任何请求结构体传递到方法中，然后序列化发送到服务器，无需使用显示返回响应的方法。</p>
<p>接下来，使用<code>msgPack</code>库对请求进行<code>URL</code>编码，可以按照处理其他标准结构化数据的数据逻辑：首先通过NewEncoder()创建编码器，然后调用<code>Encode</code>方法，这将用<code>MessagePack</code>编码表示的请求体填充buf变量。之后发出POST请求，将主题设置为序列化数据。</p>
<p>然后接下来定义三个方法，每个方法使用相同的常规流程。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(msf *Metasploit)</span></span> Login() <span class="type">error</span> &#123;</span><br><span class="line">	ctx := &amp;loginReq&#123;</span><br><span class="line">		Method:   <span class="string">&quot;auth.login&quot;</span>,</span><br><span class="line">		Username: msf.user,</span><br><span class="line">		Password: msf.pass,</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">var</span> res loginRes</span><br><span class="line">	<span class="keyword">if</span> err := msf.send(ctx, &amp;res); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;</span><br><span class="line">	msf.token = res.Token</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(msf *Metasploit)</span></span> Logout() <span class="type">error</span> &#123;</span><br><span class="line">	ctx := &amp;logoutReq&#123;</span><br><span class="line">		Method:      <span class="string">&quot;auth.logout&quot;</span>,</span><br><span class="line">		Token:       msf.token,</span><br><span class="line">		LogoutToken: msf.token,</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">var</span> res logoutRes</span><br><span class="line">	<span class="keyword">if</span> err := msf.send(ctx, &amp;res); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;</span><br><span class="line">	msf.token = <span class="string">&quot;&quot;</span></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(msf *Metasploit)</span></span> SessionList() (<span class="keyword">map</span>[<span class="type">uint32</span>]SessionListRes, <span class="type">error</span>) &#123;</span><br><span class="line">	req := &amp;sessionListReq&#123;Method: <span class="string">&quot;session.list&quot;</span>, Token: msf.token&#125;</span><br><span class="line">	res := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">uint32</span>]SessionListRes)</span><br><span class="line">	<span class="keyword">if</span> err := msf.send(req, &amp;res); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> id, session := <span class="keyword">range</span> res &#123;</span><br><span class="line">		session.ID = id</span><br><span class="line">		res[id] = session</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> res, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是，<code>RPC</code>函数 session.list()需要有效的身份令牌，这就意味着必须要先登录，但是才能掉用方法<code>SessionList()</code></p>
<p>所以可以对<code>New</code>函数做一个更改</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">New</span><span class="params">(host, user, pass <span class="type">string</span>)</span></span> (*Metasploit,<span class="type">error</span>)&#123;</span><br><span class="line">	msf := &amp;Metasploit&#123;</span><br><span class="line">		host: host,</span><br><span class="line">		user: user,</span><br><span class="line">		pass: pass,</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> err := msf.Login(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>,err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> msf,<span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="6-执行"><a href="#6-执行" class="headerlink" title="6.执行"></a>6.执行</h3><p>创建 <code>clinet/main.go</code>文件</p>
<p>这里没用获取环境变量，原文是</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">host := os.Getenv(<span class="string">&quot;MSFHOST&quot;</span>)</span><br><span class="line">pass := os.Getenv(<span class="string">&quot;MSFPASS&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>这里输入自己的数值</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;MSF/rpc&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  &#123;</span><br><span class="line">	host := <span class="string">&quot;&quot;</span></span><br><span class="line">	pass := <span class="string">&quot;&quot;</span></span><br><span class="line">	user := <span class="string">&quot;msf&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> host == <span class="string">&quot;&quot;</span> || pass == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">		log.Fatalln(<span class="string">&quot;Missing required environment variable MSFHOST or MSFPASS&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	msf, err := rpc.New(host, user, pass)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Panicln(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> msf.Logout()</span><br><span class="line"></span><br><span class="line">	sessions, err := msf.SessionList()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Panicln(err)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">&quot;Sessions:&quot;</span>)</span><br><span class="line">	<span class="keyword">for</span> _, session := <span class="keyword">range</span> sessions &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;%5d  %s\n&quot;</span>, session.ID, session.Info)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/h0ld1rs/image/image/20220302000546.png"></p>
<p>如果有<code>Meterpreter</code>会话则会保存下来</p>
<h2 id="0x04-使用Bing-Scraping解析文档元数据"><a href="#0x04-使用Bing-Scraping解析文档元数据" class="headerlink" title="0x04 使用Bing Scraping解析文档元数据"></a>0x04 使用Bing Scraping解析文档元数据</h2><p>在渗透测试的时候，相对有用的信息可能会非常关键，这些信息会增加我们对目标攻击的可能性。这些信息的来源之一是<code>文档元数据</code>。</p>
<p>某些情况下，这类信息会包含地理坐标， 应用程序版本，操作系统信息和用户名。</p>
<p>我们可以使用搜索引擎去检索关于一个组织的特定文件。</p>
<h3 id="1-配置和环境规划"><a href="#1-配置和环境规划" class="headerlink" title="1. 配置和环境规划"></a>1. 配置和环境规划</h3><p>我们首先对目标进行声明，我们只关注以<code>xlsx</code>,<code>docx</code>,<code>pptx</code>等结尾的<code>Office Open Xml</code>文档，虽然也可以关注旧版的<code>Office</code>数据类型，但是二进制格式使他们成倍增加，并且会在增加代码复杂性的同时降低其可阅读性。对于<code>PDF</code>文件也是如此。</p>
<p>我们使用抓取<code>HTML</code>页面，而不是使用<code>搜索引擎API</code>，在没有API的情况下，使用页面抓取的方法更为强大。</p>
<blockquote>
<p>在这里我们使用一个<code>goquery</code>，他的作用等用于<code>jquery</code></p>
<p>安装：go get github.com&#x2F;PuerkitoBio&#x2F;goquery</p>
</blockquote>
<h3 id="2-定义元数据包"><a href="#2-定义元数据包" class="headerlink" title="2. 定义元数据包"></a>2. 定义元数据包</h3><p>在代码中定义与<code>XML</code>数据集相对应的<code>GO</code>类型，然后将代码放入一个名为 <code>openxml.go</code>的文件中，该文件是我们想要解析的每个<code>XML</code>的其中一种类型，然后添加数据映射和对应的函数，以确定与<code>Appilcation</code>对应的可识别的<code>Office</code>版本</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> metadata</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;encoding/xml&quot;</span></span><br><span class="line">	<span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> OfficeVersions = <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span>&#123;</span><br><span class="line">	<span class="string">&quot;16&quot;</span>: <span class="string">&quot;2016&quot;</span>,</span><br><span class="line">	<span class="string">&quot;15&quot;</span>: <span class="string">&quot;2013&quot;</span>,</span><br><span class="line">	<span class="string">&quot;14&quot;</span>: <span class="string">&quot;2010&quot;</span>,</span><br><span class="line">	<span class="string">&quot;12&quot;</span>: <span class="string">&quot;2007&quot;</span>,</span><br><span class="line">	<span class="string">&quot;11&quot;</span>: <span class="string">&quot;2003&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> OfficeCoreProperty <span class="keyword">struct</span> &#123;</span><br><span class="line">	XMLName        xml.Name <span class="string">`xml:&quot;coreProperties&quot;`</span></span><br><span class="line">	Creator        <span class="type">string</span>   <span class="string">`xml:&quot;creator&quot;`</span></span><br><span class="line">	LastModifiedBy <span class="type">string</span>   <span class="string">`xml:&quot;lastModifiedBy&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> OfficeAppProperty <span class="keyword">struct</span> &#123;</span><br><span class="line">	XMLName     xml.Name <span class="string">`xml:&quot;Properties&quot;`</span></span><br><span class="line">	Application <span class="type">string</span>   <span class="string">`xml:&quot;Application&quot;`</span></span><br><span class="line">	Company     <span class="type">string</span>   <span class="string">`xml:&quot;Company&quot;`</span></span><br><span class="line">	Version     <span class="type">string</span>   <span class="string">`xml:&quot;AppVersion&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *OfficeAppProperty)</span></span> GetMajorVersion() <span class="type">string</span> &#123;</span><br><span class="line">	tokens := strings.Split(a.Version, <span class="string">&quot;.&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(tokens) &lt; <span class="number">2</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;Unknown&quot;</span></span><br><span class="line">	&#125;</span><br><span class="line">	v, ok := OfficeVersions[tokens[<span class="number">0</span>]]</span><br><span class="line">	<span class="keyword">if</span> !ok &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;Unknown&quot;</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> v</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-把数据映射到结构体"><a href="#3-把数据映射到结构体" class="headerlink" title="3. 把数据映射到结构体"></a>3. 把数据映射到结构体</h3><p>接下来要读取适当的文件内容，并将内容赋值给所定义的结构体代码。为此定义函数<code>NewProperties()</code>和<code>proccess()</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">process</span><span class="params">(f *zip.File, prop <span class="keyword">interface</span>&#123;&#125;)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">	rc, err := f.Open()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> rc.Close()</span><br><span class="line">	<span class="keyword">if</span> err := xml.NewDecoder(rc).Decode(&amp;prop); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewProperties</span><span class="params">(r *zip.Reader)</span></span> (*OfficeCoreProperty, *OfficeAppProperty, <span class="type">error</span>) &#123;</span><br><span class="line">	<span class="keyword">var</span> coreProps OfficeCoreProperty</span><br><span class="line">	<span class="keyword">var</span> appProps OfficeAppProperty</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> _, f := <span class="keyword">range</span> r.File &#123;</span><br><span class="line">		<span class="keyword">switch</span> f.Name &#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">&quot;docProps/core.xml&quot;</span>:</span><br><span class="line">			<span class="keyword">if</span> err := process(f, &amp;coreProps); err != <span class="literal">nil</span> &#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">nil</span>, <span class="literal">nil</span>, err</span><br><span class="line">			&#125;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">&quot;docProps/app.xml&quot;</span>:</span><br><span class="line">			<span class="keyword">if</span> err := process(f, &amp;appProps); err != <span class="literal">nil</span> &#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">nil</span>, <span class="literal">nil</span>, err</span><br><span class="line">			&#125;</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> &amp;coreProps, &amp;appProps, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>函数<code>NewProperties()</code>接受了一个<code>* zio.Reader</code>的参数，它表示<code>Zip归档</code>文件的<code>io.Reader</code>，使用<code>io.Reader</code>实例，遍历归档文件类型，中所有文件并检查文件名，如果文件名与两个属性文件名中任意一个匹配，则调用函数<code>process()</code>，并且传入文件要和填充的任意两个结构体类型:<code>OfficeCoreProperty</code>或者<code>OfficeAppProperty</code></p>
<p>函数<code>process</code>接受两个参数，<code>* zip.file</code> 和 <code>interface</code>。此代码接受通用的<code>interface()</code>类型，以允许将文件内容赋给任何数据类型，因为在<code>process</code>中没有特定的数据类型，增加了代码的重用性。在函数内，代码读取文件的内容并将<code>XML</code>数据解码为<code>结构体</code>。</p>
<h3 id="4-使用Bing搜索和接受文件"><a href="#4-使用Bing搜索和接受文件" class="headerlink" title="4. 使用Bing搜索和接受文件"></a>4. 使用<code>Bing</code>搜索和接受文件</h3><p>现在，我们已经有了打开，读取，解析和提取<code>Office Open Xml</code>文档需要的所有代码，并且知道我们接下来要做什么</p>
<ol>
<li>使用适当的过滤器向<code>Bing</code>提交搜索请求以检索目标结果</li>
<li>从HTML响应中提取<code>HREF(链接)</code>数据以获得文档的导向URL</li>
<li>为每个导向文档URL提交一个HTTP请求</li>
<li>解析响应正文以创建<code>zip.Reader</code></li>
<li>将<code>zip.Reader</code>传递到我们已经开发的代码中以提取元数据</li>
</ol>
<blockquote>
<p>site: 用于过滤特定的域结果</p>
<p>fileType: 用于根据资源文件类型过滤结果</p>
<p>instreamset：用于过滤结果以仅包含某些文件扩展名</p>
</blockquote>
<p>例如：从<code>nytimes.com</code>中检索<code>docx</code>文件的查询示例：</p>
<blockquote>
<p>site:nytimes.com &amp;&amp; filetype: docx &amp;&amp;instreamset:(url title):docx</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/h0ld1rs/image/image/20220302112348.png"></p>
<p>接下来，我们要做的是确定<code>文档链接</code>在文档对象模型(DOM)中的位置，可以使用F12进行查看。</p>
<p>有了这些，我们就可以使用<code>goquery</code>来进行提取与<code>HTML</code>路劲匹配的所有数据元素</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;archive/zip&quot;</span></span><br><span class="line">	<span class="string">&quot;bing/metadata&quot;</span></span><br><span class="line">	<span class="string">&quot;bytes&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/PuerkitoBio/goquery&quot;</span></span><br><span class="line">	<span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">	<span class="string">&quot;net/url&quot;</span></span><br><span class="line">	<span class="string">&quot;os&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handler</span><span class="params">(i <span class="type">int</span>, s *goquery.Selection)</span></span> &#123;</span><br><span class="line">	url, ok := s.Find(<span class="string">&quot;a&quot;</span>).Attr(<span class="string">&quot;href&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> !ok &#123;</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Printf(<span class="string">&quot;%d: %s\n&quot;</span>, i, url)</span><br><span class="line">	res, err := http.Get(url)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	buf, err := ioutil.ReadAll(res.Body)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> res.Body.Close()</span><br><span class="line"></span><br><span class="line">	r, err := zip.NewReader(bytes.NewReader(buf), <span class="type">int64</span>(<span class="built_in">len</span>(buf)))</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	cp, ap, err := metadata.NewProperties(r)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	log.Printf(</span><br><span class="line">		<span class="string">&quot;%21s %s - %s %s\n&quot;</span>,</span><br><span class="line">		cp.Creator,</span><br><span class="line">		cp.LastModifiedBy,</span><br><span class="line">		ap.Application,</span><br><span class="line">		ap.GetMajorVersion())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(os.Args) != <span class="number">3</span> &#123;</span><br><span class="line">		log.Fatalln(<span class="string">&quot;Missing required argument. Usage: main.go &lt;domain&gt; &lt;ext&gt;&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	domain := os.Args[<span class="number">1</span>]</span><br><span class="line">	filetype := os.Args[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">	q := fmt.Sprintf(</span><br><span class="line">		<span class="string">&quot;site:%s &amp;&amp; filetype:%s &amp;&amp; instreamset:(url title):%s&quot;</span>,</span><br><span class="line">		domain,</span><br><span class="line">		filetype,</span><br><span class="line">		filetype)</span><br><span class="line"></span><br><span class="line">	search := fmt.Sprintf(<span class="string">&quot;http://www.bing.com/search?q=%s&quot;</span>, url.QueryEscape(q))</span><br><span class="line">	res, err := http.Get(search)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	doc, err := goquery.NewDocumentFromReader(res.Body)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Panicln(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> res.Body.Close()</span><br><span class="line">	s := <span class="string">&quot;html body div#b_content ol#b_results li.b_algo h2&quot;</span></span><br><span class="line">	doc.Find(s).Each(handler)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">h0ld1rs</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://h0ld1rs.github.io/posts/32502.html">https://h0ld1rs.github.io/posts/32502.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://h0ld1rs.github.io" target="_blank">h0ld1rs的博客</a>！</span></div></div><div class="tag_share"><div class="post_share"><div class="social-share" data-image="/img/image/4.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/13916.html"><img class="prev-cover" src="/img/image/5.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Go渗透测试笔记(四)</div></div></a></div><div class="next-post pull-right"><a href="/posts/26832.html"><img class="next-cover" src="/img/image/1.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">博客搭建</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/61606.html" title="Go渗透测试笔记(一)"><img class="cover" src="/img/image/2.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-14</div><div class="title">Go渗透测试笔记(一)</div></div></a></div><div><a href="/posts/31081.html" title="go渗透测试笔记(二)"><img class="cover" src="/img/image/3.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-18</div><div class="title">go渗透测试笔记(二)</div></div></a></div><div><a href="/posts/13916.html" title="Go渗透测试笔记(四)"><img class="cover" src="/img/image/5.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-03-02</div><div class="title">Go渗透测试笔记(四)</div></div></a></div><div><a href="/posts/12296.html" title="Go渗透测试笔记(五)"><img class="cover" src="/img/image/6.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-03-04</div><div class="title">Go渗透测试笔记(五)</div></div></a></div><div><a href="/posts/166.html" title="Go渗透测试笔记(七)"><img class="cover" src="/img/image/8.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-03-05</div><div class="title">Go渗透测试笔记(七)</div></div></a></div><div><a href="/posts/36907.html" title="Go渗透测试笔记(六)"><img class="cover" src="/img/image/7.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-03-05</div><div class="title">Go渗透测试笔记(六)</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/1.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">h0ld1rs</div><div class="author-info__description">希望能认识更多师傅，学到更多东西</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">19</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">7</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/h0ld1rs"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Go%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E7%AC%94%E8%AE%B0-%E4%B8%89-%E2%80%94HTTP%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%B8%8E%E5%B7%A5%E5%85%B7%E7%9A%84%E8%BF%9C%E7%A8%8B%E4%BA%A4%E4%BA%92"><span class="toc-number">1.</span> <span class="toc-text">Go渗透测试笔记(三)—HTTP客户端与工具的远程交互</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x00-Go%E7%9A%84HTTP%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-number">1.1.</span> <span class="toc-text">0x00 Go的HTTP基础知识</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0X01-%E8%B0%83%E7%94%A8HTTP-API"><span class="toc-number">1.2.</span> <span class="toc-text">0X01 调用HTTP API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E8%B0%83%E7%94%A8HTTP%E6%96%B9%E6%B3%95"><span class="toc-number">1.2.1.</span> <span class="toc-text">1. 调用HTTP方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%94%9F%E6%88%90%E4%B8%80%E4%B8%AA%E8%AF%B7%E6%B1%82"><span class="toc-number">1.2.2.</span> <span class="toc-text">2. 生成一个请求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E4%BD%BF%E7%94%A8%E7%BB%93%E6%9E%84%E5%8C%96%E8%BF%9B%E8%A1%8C%E8%A7%A3%E6%9E%90"><span class="toc-number">1.2.3.</span> <span class="toc-text">3. 使用结构化进行解析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0X02-%E6%9E%84%E5%BB%BA%E4%B8%8EShodan%E4%BA%A4%E4%BA%92%E7%9A%84HTTP%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">1.3.</span> <span class="toc-text">0X02 构建与Shodan交互的HTTP客户端</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%B8%85%E7%90%86API%E8%B0%83%E7%94%A8"><span class="toc-number">1.3.1.</span> <span class="toc-text">1. 清理API调用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%9F%A5%E8%AF%A2Shodan-%E8%AE%A2%E9%98%85%E6%83%85%E5%86%B5"><span class="toc-number">1.3.2.</span> <span class="toc-text">2. 查询Shodan 订阅情况</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x03-%E4%B8%8EMetasploit%E4%BA%A4%E4%BA%92"><span class="toc-number">1.4.</span> <span class="toc-text">0x03 与Metasploit交互</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%AE%9A%E4%B9%89%E7%9B%AE%E6%A0%87"><span class="toc-number">1.4.1.</span> <span class="toc-text">1. 定义目标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E8%8E%B7%E5%8F%96%E6%9C%89%E6%95%88%E4%BB%A4%E7%89%8C"><span class="toc-number">1.4.2.</span> <span class="toc-text">2. 获取有效令牌</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%AE%9A%E4%B9%89%E8%AF%B7%E6%B1%82%E5%92%8C%E5%93%8D%E5%BA%94"><span class="toc-number">1.4.3.</span> <span class="toc-text">3. 定义请求和响应</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%88%9B%E5%BB%BA%E9%85%8D%E7%BD%AE%E7%BB%93%E6%9E%84%E4%BD%93%E5%92%8CRPC%E6%96%B9%E6%B3%95"><span class="toc-number">1.4.4.</span> <span class="toc-text">4. 创建配置结构体和RPC方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%89%A7%E8%A1%8C%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8"><span class="toc-number">1.4.5.</span> <span class="toc-text">5. 执行远程调用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E6%89%A7%E8%A1%8C"><span class="toc-number">1.4.6.</span> <span class="toc-text">6.执行</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x04-%E4%BD%BF%E7%94%A8Bing-Scraping%E8%A7%A3%E6%9E%90%E6%96%87%E6%A1%A3%E5%85%83%E6%95%B0%E6%8D%AE"><span class="toc-number">1.5.</span> <span class="toc-text">0x04 使用Bing Scraping解析文档元数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E9%85%8D%E7%BD%AE%E5%92%8C%E7%8E%AF%E5%A2%83%E8%A7%84%E5%88%92"><span class="toc-number">1.5.1.</span> <span class="toc-text">1. 配置和环境规划</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%AE%9A%E4%B9%89%E5%85%83%E6%95%B0%E6%8D%AE%E5%8C%85"><span class="toc-number">1.5.2.</span> <span class="toc-text">2. 定义元数据包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%8A%8A%E6%95%B0%E6%8D%AE%E6%98%A0%E5%B0%84%E5%88%B0%E7%BB%93%E6%9E%84%E4%BD%93"><span class="toc-number">1.5.3.</span> <span class="toc-text">3. 把数据映射到结构体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E4%BD%BF%E7%94%A8Bing%E6%90%9C%E7%B4%A2%E5%92%8C%E6%8E%A5%E5%8F%97%E6%96%87%E4%BB%B6"><span class="toc-number">1.5.4.</span> <span class="toc-text">4. 使用Bing搜索和接受文件</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/54507.html" title="扫描器之文本相似度计算"><img src="/img/image/20.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="扫描器之文本相似度计算"/></a><div class="content"><a class="title" href="/posts/54507.html" title="扫描器之文本相似度计算">扫描器之文本相似度计算</a><time datetime="2022-03-22T07:35:07.000Z" title="发表于 2022-03-22 15:35:07">2022-03-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/32500.html" title="spring-gateaway分析"><img src="/img/image/19.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="spring-gateaway分析"/></a><div class="content"><a class="title" href="/posts/32500.html" title="spring-gateaway分析">spring-gateaway分析</a><time datetime="2022-03-20T15:33:32.000Z" title="发表于 2022-03-20 23:33:32">2022-03-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/15596.html" title="SPEL学习"><img src="/img/image/18.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SPEL学习"/></a><div class="content"><a class="title" href="/posts/15596.html" title="SPEL学习">SPEL学习</a><time datetime="2022-03-19T03:10:48.000Z" title="发表于 2022-03-19 11:10:48">2022-03-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/54936.html" title="jsonp学习"><img src="/img/image/17.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="jsonp学习"/></a><div class="content"><a class="title" href="/posts/54936.html" title="jsonp学习">jsonp学习</a><time datetime="2022-03-18T05:59:32.000Z" title="发表于 2022-03-18 13:59:32">2022-03-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/51438.html" title="Log4j2分析入门"><img src="/img/image/15.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Log4j2分析入门"/></a><div class="content"><a class="title" href="/posts/51438.html" title="Log4j2分析入门">Log4j2分析入门</a><time datetime="2022-03-18T03:36:55.000Z" title="发表于 2022-03-18 11:36:55">2022-03-18</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/img/image/4.png')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By h0ld1rs</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><div class="js-pjax"><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'commnet-1gmkug2k1ca99452',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.vemoji)'))
      }
    }, null))
  }

  const getCount = () => {
    twikoo.getCommentsCount({
      envId: 'commnet-1gmkug2k1ca99452',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      document.getElementById('twikoo-count').innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>